<!doctype html>
<meta charset=utf-8>
<title>HTML Editing Commands</title>
<link rel=stylesheet href=http://www.whatwg.org/style/specification>
<style>
 pre, code { font-family:monospace, sans-serif; }
 h2 code, h3 code, h4 code,
 h2 :link, h3 :link, h4 :link,
 h2 :visited, h3 :visited, h4 :visited
 { font:inherit; color:inherit; font-style:italic; }
 @media print {
   :not([data-anolis-spec]) > [data-anolis-spec]::after {
     content: "[" attr(data-anolis-spec) "]";
     font-size: 0.6em;
     vertical-align: super;
     text-transform: uppercase;
   }
 }
</style>
<body class=draft>
<div class=head id=head>
<h1>HTML Editing Commands</h1>
<h2 class="no-num no-toc">Work in Progress &mdash; Last Update [DATE: 01 Jan 1901]</h2>
<dl>
 <dt>Editor
 <dd>Aryeh Gregor &lt;ayg+spec@aryeh.name>

 <dt>Version history
 <dd><a href=http://aryeh.name/gitweb.cgi?p=editcommands>http://aryeh.name/gitweb.cgi?p=editcommands</a>
</dl>
</div>


<h2 class=no-num>Table of contents</h2>
<!--toc-->


<h2>Introduction</h2>
<p>This specification defines commands to edit HTML documents programmatically.
The APIs specified here were originally introduced in Microsoft's Internet
Explorer, but have subsequently been copied by other browsers in a haphazard
and imprecise fashion.  Although the behavior specified here does not exactly
match any browser at the time of writing, it can serve as a target to converge
to in the future.

<p>Where the reasoning behind the specification is of interest, such as when
major preexisting rendering engines are known not to match it, the reasoning is
included in HTML comments so as not to distract the reader.


<h2>Issues</h2>

<ul>
  <li><p>Need to make CSS terminology more precise, about setting/unsetting CSS
  properties.  The intent is to modify the style attribute, CSSOM-style.

  <li><p>Some of the DOM stuff might benefit from more precision.  E.g., is
  there a precise algorithm for what it means to append a node someplace, if
  that node is already somewhere in the DOM?  What does that do if it's
  selected, it has state (like a video or animated image), etc.?
</ul>


<h2>Definitions</h2>

<p>A <code data-anolis-spec=domcore>Node</code> is an <dfn>HTML element
with name</dfn> <var title>name</var> if it is an <code
data-anolis-spec=domcore>Element</code>, its <span data-anolis-spec=domcore
title=concept-element-namespace>namespace</span> is the <span
data-anolis-spec=domcore>HTML namespace</span>, and its <span
data-anolis-spec=domcore title=concept-element-local-name>local name</span> is
<var title>name</var>.


<h2>Styling a Range</h2>
<p>When a user agent is to <dfn>style a <code
data-anolis-spec=domrange>Range</code></dfn> <var title>range</var>, it must
run the following steps.  There are three inputs: a CSS property name <var
title>property name</var>, a new value <var title>property value</var>, and a
nonempty list of strings <var title>tag list</var>.

<p class=XXX>This is totally made up and I have no idea yet if it matches
browsers and/or is even vaguely coherent.

<ol>
  <li><p>Let <var title>start node</var>, <var title>start offset</var>, <var
  title>end node</var>, and <var title>end offset</var> be the <span
  data-anolis-spec=domrange title=concept-range-start>start</span> and <span
  data-anolis-spec=domrange title=concept-range-end>end</span> <span
  data-anolis-spec=domrange title=concept-boundary-point-node>nodes</span> and
  <span data-anolis-spec=domrange
  title=concept-boundary-point-offset>offsets</span> of <var title>range</var>,
  respectively.

  <li><p>Let <var title>document</var> be the <code data-anolis-spec=domcore
  title=dom-Node-ownerDocument>ownerDocument</code> of <var title>start
  node</var>.

  <li><p>If <var title>start node</var> or <var title>end node</var> is not an
  <code data-anolis-spec=domcore>Element</code>, <code
  data-anolis-spec=domcore>Text</code>, <code
  data-anolis-spec=domcore>ProcessingInstruction</code>, or <code
  data-anolis-spec=domcore>Comment</code> node, or is not an <code
  data-anolis-spec=domcore>Element</code> and has no parent, abort
  these steps.

  <p class=XXX>Figure out something sensible here.

  <li><p>If <var title>start node</var> is a <code
  data-anolis-spec=domcore>Text</code> node and <var title>start offset</var>
  is neither 0 nor the <span data-anolis-spec=domrange
  title=concept-node-length>length</span> of <var title>start node</var>, run
  <code data-anolis-spec=domcore title=dom-Text-splitText>splitText(<var
  title>start offset</var>)</code> on <var title>start node</var> and set <var
  title>start node</var> to the returned node.  Set <var title>start
  offset</var> to 0.

  <li><p>If <var title>end node</var> is a <code
  data-anolis-spec=domcore>Text</code> node and <var title>end offset</var> is
  neither 0 nor the <span data-anolis-spec=domrange
  title=concept-node-length>length</span> of <var title>end node</var>, run
  <code data-anolis-spec=domcore title=dom-Text-splitText>splitText(<var
  title>end offset</var>)</code> on <var title>end node</var> and set <var
  title>end node</var> to the previous sibling of the returned node.  Set <var
  title>end offset</var> to the <span data-anolis-spec=domrange
  title=concept-node-length>length</span> of the new <var title>end node</var>.

<!-- Original declarative definition
  <li><p>Let <var title>node list</var> be the list of <code
  data-anolis-spec=domcore>Node</code>s <var title>node</var> in <var
  title>document</var> satisfying all of the following conditions:

  <ul>
    <li><p>In <span data-anolis-spec=domcore>tree order</span>, <var
    title>node</var> is after the child of <var title>start node</var> with
    <span data-anolis-spec=domrange title=concept-indexof>index</span> <var
    title>start offset</var> (or after <var title>start node</var> itself, if
    <var title>start node</var> is not an <code
    data-anolis-spec=domcore>Element</code>).

    <li><p>In <span data-anolis-spec=domcore>tree order</span>, <var
    title>node</var> is before the child of <var title>end node</var> with
    <span data-anolis-spec=domrange title=concept-indexof>index</span> <var
    title>end offset</var> (or before <var title>end node</var> itself, if <var
    title>end node</var> is not an <code
    data-anolis-spec=domcore>Element</code>).

    <li><p><var title>node</var> is not a <span data-anolis-spec=domcore
    title=concept-descendant-node>descendant</span> of any other <code
    data-anolis-spec=domcore>Node</code> that satisfies the previous two
    conditions.
  </ul>

  <li><p>If <var title>start node</var> is a <code
  data-anolis-spec=domcore>Text</code> node and <var title>start offset</var>
  is 0, add <var title>start node</var> to <var title>node list</var>.

  <li><p>If <var title>end node</var> is a <code
  data-anolis-spec=domcore>Text</code> node and <var title>end offset</var> is
  the <span data-anolis-spec=domrange title=concept-node-length>length</span>
  of <var title>end node</var>, add <var title>end node</var> to <var
  title>node list</var>.

  <li><p>If there is some <code data-anolis-spec=domcore>Element</code> that is
  not in <var title>node list</var> but which has one or more children, and its
  children are all in <var title>node list</var>, add that <code
  data-anolis-spec=domcore>Element</code> to <var title>node list</var> and
  remove all its children from <var title>node list</var>.  Repeat until there
  is no such <code data-anolis-spec=domcore>Element</code>.
  -->

  <li><p>Let <var title>node list</var> be an empty list of <code
  data-anolis-spec=domcore>Node</code>s.

  <li><p>If <var title>start node</var> is an <code
  data-anolis-spec=domcore>Element</code> with at least one child, let <var
  title>node</var> be the first <code data-anolis-spec=domcore>Node</code>
  after the child of <var title>start node</var> with <span
  data-anolis-spec=domrange title=concept-indexof>index</span> <var title>start
  offset</var>, in <span data-anolis-spec=domcore>tree order</span>.

  <li><p>Otherwise, if <var title>start node</var> is a <code
  data-anolis-spec=domcore>Text</code> node and <var title>start offset</var>
  is 0, or if <var title>start node</var> is an <code
  data-anolis-spec=domcore>Element</code> with no children, let <var
  title>node</var> be <var title>start node</var>.

  <li><p>Otherwise, let <var title>node</var> be the first <code
  data-anolis-spec=domcore>Node</code> after <var title>start node</var> in
  <span data-anolis-spec=domcore>tree order</span>.

  <li><p>If <var title>end node</var> is an <code
  data-anolis-spec=domcore>Element</code> with at least one child, let <var
  title>end</var> be the first <code data-anolis-spec=domcore>Node</code>
  before the child of <var title>end node</var> with <span
  data-anolis-spec=domrange title=concept-indexof>index</span> <var title>end
  offset</var>, in <span data-anolis-spec=domcore>tree order</span> (or, if
  <var title>end offset</var> is <var title>end node</var>'s <span
  data-anolis-spec=domrange title=concept-node-length>length</span>, let <var
  title>end</var> be the last child of <var title>end node</var>).

  <li><p>Otherwise, if <var title>end node</var> is a <code
  data-anolis-spec=domcore>Text</code> node and <var title>end offset</var> is
  its <span data-anolis-spec=domrange title=concept-node-length>length</span>,
  or if <var title>end node</var> is an <code
  data-anolis-spec=domcore>Element</code> with no children, let <var
  title>end</var> be <var title>end node</var>.

  <li><p>Otherwise, let <var title>end</var> be the last <code
  data-anolis-spec=domcore>Node</code> before <var title>end node</var> in
  <span data-anolis-spec=domcore>tree order</span>.

  <li><p>While <var title>node</var> is not after <var title>end</var> in
  <span data-anolis-spec=domcore>tree order</span>:

  <ol>
    <li>Append <var title>node</var> to <var title>node list</var>.

    <li>Set <var title>node</var> to the first <code
    data-anolis-spec=domcore>Node</code> in <span data-anolis-spec=domcore>tree
    order</span> that is after <var title>node</var> and (if applicable) all
    its <span data-anolis-spec=domcore
    title=concept-descendant-node>descendants</span>.  If no such <code
    data-anolis-spec=domcore>Node</code> exists, break out of these substeps.
  </ol>

  <!-- Condense the node list for extra tidiness. -->
  <li><p>Let <var title>node</var> be the first <code
  data-anolis-spec=domcore>Node</code> in <var title>node list</var>.
  
  <li><p>Repeat:

  <ol>
    <li><p>If <var title>node</var> has a parent, and its parent is an <code
    data-anolis-spec=domcore>Element</code>, and all the children of <var
    title>node</var>'s parent are contained in <var title>node list</var>, add
    <var title>node</var>'s parent to <var title>node list</var> immediately
    before <var title>node</var>, then remove all children of <var
    title>node</var>'s parent from <var title>node list</var>.  Set <var
    title>node</var> to <var title>node</var>'s parent and continue these
    substeps from the beginning.

    <li><p>If <var title>node</var> is the last <code
    data-anolis-spec=domcore>Node</code> in <var title>node list</var>, break
    out of these substeps.

    <li><p>Set <var title>node</var> to the next <code
    data-anolis-spec=domcore>Node</code> in <var title>node list</var>.
  </ol>

  <li><p>For each <var title>node</var> in <var title>node list</var>, in <span
  data-anolis-spec=domcore>tree order</span>:

  <ol>
    <li><p>If <var title>node</var> is an <code
    data-anolis-spec=domcore>Element</code>:

    <ol>
      <li><p>If <var title>node</var> is an <span>HTML element with name</span>
      in <var title>tag list</var>, unset the CSS property <var title>property
      name</var> of <var title>node</var>.  Otherwise, set the CSS property
      <var title>property name</var> of <var title>node</var> to <var
      title>property value</var>.

      <li><p>For each <span data-anolis-spec=domcore
      title=concept-descendant-node>descendant</span> <var
      title>descendant</var> of <var title>node</var> that is an <code
      data-anolis-spec=domcore>Element</code>:

      <ol>
        <li><p>If either
        
        <ul>
          <li><p><var title>descendant</var> is an <span>HTML element with
          name</span> either "span" or in <var title>tag list</var>, and it has
          only a single attribute, and that attribute is named "style", and
          that style attribute sets only the CSS property <var title>property
          name</var>; or

          <li><p><var title>descendant</var> is an <span>HTML element with
          name</span> in <var title>tag list</var> and it has no attributes,
        </ul>

        <p>then append all of <var title>descendant</var>'s children to the
        parent of <var title>descendant</var> in order immediately before <var
        title>descendant</var>, and remove <var title>descendant</var>.
        Continue with the next descendant.

        <li><p>Unset the CSS property <var title>property name</var> of <var
        title>descendant</var>.
        <!-- Only WebKit appears to do this, but it makes sense.  Otherwise
        things like <span style=font-weight:normal> won't disappear when you
        apply bold.  (Same applies to the places below where we unset the CSS
        property here.) -->

        <li><p>If <var title>descendant</var> is an <span>HTML element with
        name</span> in <var title>tag list</var>, let <var title>new
        descendant</var> be a new <span>HTML element with name</span> "span",
        with the same attributes and <code data-anolis-spec=domcore
        title=dom-Node-ownerDocument>ownerDocument</code> as <var
        title>descendant</var>.  Append <var title>new descendant</var> to <var
        title>descendant</var>'s parent as the previous sibling of <var
        title>descendant</var>, then append all of <var
        title>descendant</var>'s children to <var title>new descendant</var> in
        order, then remove <var title>descendant</var>.
      </ol>
    </ol>

    <li><p>Otherwise:

    <ol>
      <li><p>If <var title>node</var> is not the first child of its parent,
      and its previous sibling is an <span>HTML element with name</span> equal
      to the first string in <var title>tag list</var>, append <var
      title>node</var> to <var title>node</var>'s previous sibling as the last
      child.  Continue with the next <code data-anolis-spec=domcore>Node</code>
      in <var title>node list</var>.
      <!-- Thus we merge things together a bit.  This could probably use more
      thought. -->

      <li><p>If <var title>node</var> is not a <code
      data-anolis-spec=domcore>Text</code> node, or if its <span
      data-anolis-spec=domcore title=dom-CharacterData-data>data</span> is a
      sequence of zero or more <span data-anolis-spec=html title="space
      character">space characters</span>, continue with the next <code
      data-anolis-spec=domcore>Node</code> in <var title>node list</var>.
      <!-- This avoids wrapping whitespace-only text nodes, which agrees with
      Gecko and WebKit.  IE9 and Opera wrap the whitespace-only text nodes,
      which seems pointless. -->
      
      <li><p>Let <var title>new parent</var> be a new <span>HTML element with
      name</span> equal to the first string in <var title>tag list</var>, with
      no attributes, and <code data-anolis-spec=domcore
      title=dom-Node-ownerDocument>ownerDocument</code> set to <var
      title>document</var>.
      
      <li><p>Append <var title>new parent</var> to <var title>node</var>'s
      parent as the previous sibling of <var title>node</var>.

      <li><p>Append <var title>node</var> to <var title>new parent</var> as
      its last child.
    </ol>
  </ol>
</ol>

<!-- Out of IE9, Gecko, WebKit, and Opera, when asked to (e.g.) bold an
element, IE9 and WebKit and Opera wrap various descendants in <b> or <strong>;
Gecko just adds a style attribute.  The latter is simpler, particularly because
you then don't have to worry about making sure you only insert your tags in a
valid place (which you have to so that text/html serialization is possible, if
nothing else).  I originally specced the former approach, retained here in case
I want to switch back:

<p>When a user agent is to <dfn title=wrap-range-in-tag>wrap a <code
data-anolis-spec=domrange>Range</code> <var title>range</var> in a tag <var
title>tag</var></dfn>, treating <var title>tag list</var> as equivalent and
overriding CSS <var title>property</var>, it must run the following steps:

<p class=XXX>This is totally made up and I have no idea yet if it matches
browsers and/or is even vaguely coherent.

<ol>
  <li><p>Let <var title>start node</var>, <var title>start offset</var>, <var
  title>end node</var>, and <var title>end offset</var> be the <span
  data-anolis-spec=domrange title=concept-range-start>start</span> and <span
  data-anolis-spec=domrange title=concept-range-end>end</span> <span
  data-anolis-spec=domrange title=concept-boundary-point-node>nodes</span> and
  <span data-anolis-spec=domrange
  title=concept-boundary-point-offset>offsets</span> of <var title>range</var>,
  respectively.

  <li><p>Let <var title>document</var> be the <code data-anolis-spec=domcore
  title=dom-Node-ownerDocument>ownerDocument</code> of <var title>start
  node</var>.

  <li><p>If <var title>start node</var> is a <code
  data-anolis-spec=domcore>Text</code>, <code
  data-anolis-spec=domcore>ProcessingInstruction</code>, or <code
  data-anolis-spec=domcore>Comment</code> node, and it has no parent, abort
  these steps.

  <p class=XXX>Figure out something sensible here.  Doesn't make sense except
  in IE, since other browsers fail if it's not contentEditable.  What does IE
  do?  What do we expect?

  <li><p>If <var title>start node</var> is a <code
  data-anolis-spec=domcore>Text</code> node and <var title>start offset</var>
  is neither 0 nor the <span data-anolis-spec=domrange
  title=concept-node-length>length</span> of <var title>start node</var>, run
  <code data-anolis-spec=domcore title=dom-Text-splitText>splitText(<var
  title>start offset</var>)</code> on <var title>start node</var> and set <var
  title>start node</var> to the returned node.  Set <var title>start
  offset</var> to 0.

  <li><p>If <var title>start node</var> is a <code
  data-anolis-spec=domcore>Text</code> node and <var title>start offset</var>
  is 0, set <var title>start offset</var> to the <span
  data-anolis-spec=domrange title=concept-indexof>index of</span> <var
  title>start node</var> in its parent, then set <var title>start node</var> to
  its parent.

  <li><p>If <var title>start node</var> is a <code
  data-anolis-spec=domcore>Text</code>, <code
  data-anolis-spec=domcore>Comment</code>, or <code
  data-anolis-spec=domcore>ProcessingInstruction</code> node, set <var
  title>start offset</var> to one plus the <span data-anolis-spec=domrange
  title=concept-indexof>index of</span> <var title>start node</var> in its
  parent, then set <var title>start node</var> to its parent.

  <li><p>If <var title>end node</var> is a <code
  data-anolis-spec=domcore>Text</code> node and <var title>end offset</var> is
  neither 0 nor the <span data-anolis-spec=domrange
  title=concept-node-length>length</span> of <var title>end node</var>, run
  <code data-anolis-spec=domcore title=dom-Text-splitText>splitText(<var
  title>end offset</var>)</code> on <var title>end node</var> and set <var
  title>end node</var> to the previous sibling of the returned node.  Set <var
  title>end offset</var> to the <span data-anolis-spec=domrange
  title=concept-node-length>length</span> of the new <var title>end node</var>.

  <li><p>If <var title>end node</var> is a <code
  data-anolis-spec=domcore>Text</code> node and <var title>end offset</var> is
  the <span data-anolis-spec=domrange title=concept-node-length>length</span>
  of <var title>end node</var>, set <var title>end offset</var> to one plus the
  <span data-anolis-spec=domrange title=concept-indexof>index of</span> <var
  title>end node</var> in its parent, then set <var title>end node</var> to its
  parent.

  <li><p>If <var title>end node</var> is a <code
  data-anolis-spec=domcore>Text</code>, <code
  data-anolis-spec=domcore>Comment</code>, or <code
  data-anolis-spec=domcore>ProcessingInstruction</code> node, set <var
  title>end offset</var> to the <span data-anolis-spec=domrange
  title=concept-indexof>index of</span> <var title>end node</var> in its
  parent, then set <var title>end node</var> to its parent.

  <p class=note>The previous several steps have ensured that <var title>start
  node</var> and <var title>end node</var> are not <code
  data-anolis-spec=domcore>Text</code>, <code
  data-anolis-spec=domcore>Comment</code>, or <code
  data-anolis-spec=domcore>ProcessingInstruction</code> nodes, so <var
  title>start offset</var> and <var title>end offset</var> now represent node
  offsets instead of character offsets.

  <li><p>Let <var title>node</var> equal <var title>start node</var> and let <var
  title>offset</var> equal <var title>start offset</var>.

  <li><p>Repeat the following steps until aborted:
  <ol>
    <li><p><i title id=wrap-algorithm-start>Start</i>: If <var title>node</var> is
    after <var title>end node</var> in <span data-anolis-spec=domcore>tree
    order</span>, or if <var title>node</var> equals <var title>end node</var>
    and <var title>offset</var> is greater than or equal to <var title>end
    offset</var>, abort this subalgorithm.

    <li><p>Let <var title>element</var> be a new <code
    data-anolis-spec=domcore>Element</code> with no attributes, <span
    data-anolis-spec=domcore title=concept-element-namespace>namespace</span>
    set to the <span data-anolis-spec=domcore>HTML namespace</span>, <span
    data-anolis-spec=domcore title=concept-element-local-name>local name</span>
    set to <var title>tag</var>, and <code data-anolis-spec=domcore
    title=dom-Node-ownerDocument>ownerDocument</code> set to <var
    title>document</var>.

    <li><p>While <var title>node</var> has a child with <span
    data-anolis-spec=domrange title=concept-indexof>index</span> <var
    title>offset</var>, and that child meets one of the following conditions,
    take the described action (if any) and increment <var title>offset</var>:

    <dl class=switch>
      <dt>The child is a <code data-anolis-spec=domcore>Text</code> node whose
      <code data-anolis-spec=domcore title=dom-CharacterData-data>data</code>
      consists of zero or more <span data-anolis-spec=html title="space
      character">space characters</span>
      <!- - This avoids wrapping whitespace-only text nodes, which agrees with
      WebKit.  IE9 wraps the whitespace-only text nodes, and Gecko tries to do
      something crazy like add CSS attributes instead of elements. - ->
      <dt>The child is a <code data-anolis-spec=domcore>Comment</code>, <code
      data-anolis-spec=domcore>ProcessingInstruction</code>, or <code
      data-anolis-spec=domcore>DocumentType</code>
      <dd>No action.

      <dt>The child is an <code data-anolis-spec=domcore>Element</code> whose
      <span data-anolis-spec=domcore
      title=concept-element-namespace>namespace</span> is the <span
      data-anolis-spec=domcore>HTML namespace</span> and whose <span
      data-anolis-spec=domcore title=concept-element-local-name>local
      name</span> is <var title>tag</var>
      <dd><span>Unset the CSS property</span> <var title>property</var> on each
      <span data-anolis-spec=domcore
      title=concept-descendant-node>descendant</span> of the child.
      <!- - Only WebKit appears to do this, but it makes sense.  Otherwise
      things like <span style=font-weight:normal> won't disappear when you
      apply bold.  (Same applies to the places below where we unset the CSS
      property here.) - ->
    </dl>

    <li><p>If <var title>offset</var> is equal to <var title>node</var>'s <span
    data-anolis-spec=domrange title=concept-node-length>length</span>:
    
    <ol>
      <li><p>If <var title>node</var> is the last <code
      data-anolis-spec=domcore>Node</code> in <var title>document</var>, abort
      this subalgorithm (the one that begins with <i title><a
      href=wrap-algorithm-start>start</a></i>).

      <li><p>Let <var title>node</var> equal the first <code
      data-anolis-spec=domcore>Node</code> in <var title>document</var> that is
      after all of <var title>node</var>'s <span data-anolis-spec=domcore
      title=concept-descendant-node>descendants</span> in <span
      data-anolis-spec=domcore>tree order</span>.
      
      <li><p>Let <var title>offset</var> equal zero.
      
      <li><p>Continue from <i title><a
      href=#wrap-algorithm-start>start</a></i>.
    </ol>

    <li><p>Let <var title>child</var> be the child of <var title>node</var> with
    <span data-anolis-spec=domrange title=concept-indexof>index</span> <var
    title>offset</var>.

    <p class=note><var title>child</var> will always be either an <code
    data-anolis-spec=domcore>Element</code> or a <code
    data-anolis-spec=domcore>Text</code> node.

    <li><p>If <var title>child</var> is an <code
    data-anolis-spec=domcore>Element</code> which is not part of the <span
    data-anolis-spec=html title="content models">content model</span> of <var
    title>element</var>:
    
    <ol>
      <li><p>Create a new <code data-anolis-spec=domrange>Range</code> with <span
      data-anolis-spec=domrange title=concept-range-start>start</span> (<var
      title>child</var>, 0), <span data-anolis-spec=domrange
      title=concept-range-end>end</span> (<var title>child</var>, <span
      data-anolis-spec=domrange title=concept-node-length>length</span> of <Var
      title>child</var>), and <span data-anolis-spec=domrange
      title=concept-range-root>root</span> the same as <var title>range</var>'s
      <span data-anolis-spec=domrange title=concept-range-root>root</span>.
      
      <li><p><span title=wrap-range-in-tag>Wrap that <code
      data-anolis-spec=domrange>Range</code> in <var title>tag</var></span>,
      treating <var title>tag list</var> as equivalent and overriding CSS <var
      title>property</var>.
    </ol>

    <li><p>Otherwise, if <var title>child</var> is an <code
    data-anolis-spec=domcore>Element</code> whose <span
    data-anolis-spec=domcore title=concept-element-namespace>namespace</span>
    is the <span data-anolis-spec=domcore>HTML namespace</span> and whose <span
    data-anolis-spec=domcore title=concept-element-local-name>local name</span>
    is <var title>tag</var> or is in <var title>tag list</var>, change <var
    title>child</var>'s <span data-anolis-spec=domcore
    title=concept-element-local-name>local name</span> to <var title>tag</var>
    and <span>unset the CSS property</span> <var title>property</var> on each
    of its <span data-anolis-spec=domcore
    title=concept-descendant-node>descendants</span>.

    <li><p>Otherwise:

    <p class=note><var title>child</var> is a <code
    data-anolis-spec=domcore>Text</code> node or an <code
    data-anolis-spec=domcore>Element</code> that is part of the <span
    data-anolis-spec=html title="content models">content model</span> of <var
    title>element</var>.

    <ol>
      <li><p>Append <var title>element</var> to <var title>node</var> as the
      previous sibling of <var title>child</var>.

      <li><p>While <var title>node</var> has a child with <span
      data-anolis-spec=domrange title=concept-indexof>index</span> <var
      title>offset</var> + 1, and while that child is not an <code
      data-anolis-spec=domcore>Element</code> or is an <code
      data-anolis-spec=domcore>Element</code> but is part of the <span
      data-anolis-spec=html title="content models">content model</span> of <var
      title>element</var>, append that child to <var title>element</var>.

      <p class=note>Since the next sibling of <var title>element</var> is being
      reparented on each iteration of the loop, the same <var
      title>offset</var> will point to a new node every time.

      <li><p><span>Unset the CSS property</span> <var title>property</var> on
      each of <var title>element</var>'s descendants.
    </ol>

    <li><p>Increment <var title>offset</var>.

    <p class=XXX>There appears to be no precise definition of what it means to
    append an existing element to another one.  Is it just obvious?  Should Web
    DOM Core be clearer?
  </ol>
</ol>
-->

<h2>Commands</h2>
<dl>
<dt><code title><dfn title=command-bold>bold</dfn></code>
<dd>The user agent must <span title="style a range">style each <code
data-anolis-spec=domrange>Range</code></span> of the current <code
data-anolis-spec=domrange>Selection</code> with <var title>property name</var>
"font-weight", <var title>property value</var> "bold", and <var title>tag
list</var> ["b", "strong"].

<p class=XXX>Be clearer.  What's the "current Selection", and what does it mean
to wrap "each Range"?  What if there are overlapping Ranges?

<p class=XXX>Obviously this doesn't yet even attempt to include the case where
it's already bold and the bold has to be removed.
</dl>


<h2 class=no-num id=references>References</h2><!--REFS-->
<p>All references are normative unless marked "Non-normative".</p>
<div id=anolis-references></div>


<!--
<h2 class=no-num>Acknowledgements</h2>
<p>...
-->
<script src=http://www.whatwg.org/specs/web-apps/current-work/dfn.js></script>

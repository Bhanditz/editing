<!DOCTYPE html>

<html lang='en'>
<head>
    <meta charset='utf-8'>

    <title>Input Events</title>
    <script async="" class='remove' src=
    'https://www.w3.org/Tools/respec/respec-w3c-common'></script>
    <script class='remove'>
var respecConfig = {
              specStatus:   "ED"
          ,   shortName:    "input-events"
          ,   editors:      [{ name: "Johannes Wilm",
                               mailto: "johannes@fiduswriter.org",
                               company: "Invited Expert"},
                             { name: "Ben Peters",
                               mailto: "BenjamP@microsoft.com",
                               company: "Microsoft",
                               companyURL: "http://www.microsoft.com",
                               note: "until <time>2015-02-23</time>" }]
          ,   wg:           "Web Platform Working Group"
          ,   wgURI:        "http://www.w3.org/WebPlatform/WG/"
      ,   otherLinks: [{
                  key: 'Participate',
                  data: [{
                      value: 'We are on GitHub.',
                      href: 'https://github.com/w3c/editing'
                  }, {
                      value: 'File a bug.',
                      href: 'https://github.com/w3c/editing/issues'
                  }, {
                      value: 'Commit history.',
                      href: 'https://github.com/w3c/editing/commits/gh-pages'
                  }, {
                      value: 'Mailing list.',
                      href: 'http://lists.w3.org/Archives/Public/public-webapps/'
                  }]
              }]
          ,   wgPublicList: "public-editing-tf"
          ,   license: "w3c-software-doc"
          ,   wgPatentURI:  "http://www.w3.org/2004/01/pp-impl/83482/status"
          ,   edDraftURI:   "http://w3c.github.io/editing/input-events.html"
          ,   noLegacyStyle: true
          ,   localBiblio:  {
                "STATIC-RANGE": {
                    title:    "[Proposal] StaticRange (to be used instead of Range for new APIs)"
                ,   href:     "https://discourse.wicg.io/t/proposal-staticrange-to-be-used-instead-of-range-for-new-apis/1472"
                ,   authors:  [
                        "Gary Kačmarčík"
                    ]
                ,   status:   "unofficial"
                ,   publisher:  "W3C"
                },
                "DATA-TRANSFER": {
                    title:    "The DataTransfer interface"
                ,   href:     "https://html.spec.whatwg.org/multipage/interaction.html#the-datatransfer-interface"
                ,   publisher: "WHATWG"
                }
        }
        };
    </script>
</head>

<body>
    <section id='abstract'>
        <p>This specification defines additions to events for text and related
          input. This specification builds on the Document Object Model Events
          Level 3.</p>
    </section>

    <section id='sotd'>
        <p></p>
    </section>

    <section>
        <h2>Introduction</h2>

        <p>This document describes editing related additions to 2 events - Input
          and beforeinput which are described in the
          <a href="https://w3c.github.io/uievents/">UI events spec</a>. The goal
          of these events is to allow authors to understand and/or override
          default edit behavior both before and after editing occurs.</p>
    </section>

    <section>
        <h2>Definitions</h2>
        <dl>
            <dt><code><dfn>DataTransfer</dfn></code></dt>
            <dd>An object that contains richtext and plaintext data for some inputtypes. [[!DATA-TRANSFER]]</dd>
        </dl>
    </section>

    <section>
        <h2>Problem and Use Cases</h2>The problems solved by and use cases for
        this document by this document are tracked in the <a href=
        "http://w3c.github.io/editing/editing-explainer.html">Editing
        Explainer</a> document.
    </section>

    <section id="events-inputevents">
        <h3>Input Event Types</h3>

        <p>Input events are sent before (beforeinput event) and after
        (input event) a user attempts to edit the markup. This
        includes characters, deletions, and other related edits.</p>

        <section id="interface-InputEvent">
            <h4>Interface InputEvent</h4>

            <p>The main part of the <b>InputEvent</b> is defined in [[!UI-EVENTS]]</p>

            <pre class="idl">
                [Constructor(DOMString typeArg, optional InputEventInit inputEventInitDict)]
                partial interface InputEvent {
                  readonly attribute DOMString inputType;
                  readonly attribute DataTransfer? dataTransfer;
                  StaticRange[] getTargetRanges();
                };
            </pre>

            <section id="interface-InputEvent-Attributes" dfn-for="InputEvent">
                <h5>Attributes</h5>

                <p><dfn>inputType</dfn> holds the type of input. Allowed
                values include insertText, insertNonText, insertLineBreak,
                insertParagraph, insertOrderedList, insertUnorderedList,
                insertHorizontalRule, deleteWordForward,
                deleteWordBackward, deleteLineForward, deleteLineBackward,
                deleteComposedCharacterBackward, deleteComposedCharacterForward,
                deleteContentBackward, deleteContentForward, undo, redo,
                cut, paste, bold, italic, underline, strikeThrough, superscript,
                subscript, justifyCenter, justifyRight, justifyLeft, indent,
                outdent, removeFormat, drag, drop.
                During initialization, the user agent is responsible for
                populating this field as follows:
                </p>

                <ol>
                    <li>If the user intends to insert plain text typing on a
                    keyboard, IME, speech, or similar method, the inputType
                    MUST be <b>insertText</b>.
                    </li>

                    <li>If the user intends to insert content potentially
                    containing more than just plain text using a keyboard,
                    IME, speech, or similar method, the inputType MUST be
                    <b>insertNonText</b>.

                    </li>

                    <li>If the user intends to insert a line break using a
                    keyboard, IME, speech, or similar method, the  inputType
                    MUST be <b>insertLineBreak</b>
                    </li>

                    <li>If the user intends to insert a paragraph break
                    using a keyboard, IME, speech, or similar method, the
                    inputType MUST be <b>insertParagraph</b>
                    </li>

                    <li>If the user intends to insert a numbered list
                    using a keyboard, IME, speech, or similar method, the
                    inputType MUST be <b>insertOrderedList</b>
                    </li>

                    <li>If the user intends to insert a bulleted list
                    using a keyboard, IME, speech, or similar method, the
                    inputType MUST be <b>insertUnorderedList</b>
                    </li>

                    <li>If the user intends to insert a horizontal rule
                    using a keyboard, IME, speech, or similar method, the
                    inputType MUST be <b>insertHorizontalRule</b>
                    </li>

                    <li>If the user intends to delete a character after the
                    caret position during character composition using IME, the
                    inputType MUST be <b>
                        deleteComposedCharacterForward</b>

                        <ol>
                            <li>Set the value of cancelable to <code>false</code></li>
                        </ol>
                    </li>

                    <li>If the user intends to delete a character before
                    the caret position during character composition using IME,
                    the inputType MUST be <b>
                        deleteComposedCharacterBackward</b>

                        <ol>
                            <li>Set the value of cancelable to <code>false</code></li>
                        </ol>
                    </li>

                    <li>If the user intends to delete a word directly before
                    the caret position, using a keyboard, speech, or similar
                    method, and the selection is empty, the inputType MUST be <b>
                        deleteWordBackward</b>
                    </li>

                    <li>If the user intends to delete a word directly after
                    the caret position using a keyboard, speech, or similar
                    method, and the selection is empty, the inputType MUST be <b>
                        deleteWordForward</b>
                    </li>

                    <li>If the user intends to delete a line directly before
                    the caret position using a keyboard, speech, or similar
                    method, and the selection is empty, the inputType MUST be <b>
                        deleteLineBackward</b>
                    </li>

                    <li>If the user intends to delete a line directly after
                    the caret position using a keyboard, speech, or similar
                    method, and the selection is empty, the inputType MUST be <b>
                        deleteLineForward</b>
                    </li>

                    <li>If the user intends to delete the content directly before
                    the caret position and this intention is not covered by another
                    inputType or the user itends to delete a non-collapsed selection
                    with the selection collapsing to its start after the deletion,
                    using a keyboard, speech, or similar method, the inputType
                    MUST be <b>
                        deleteContentBackward</b>
                    </li>

                    <li>If the user intends to delete the content directly after
                    the caret position and this intention is not covered by another
                    inputType or the user itends to delete a non-collapsed selection
                    with the selection collapsing to its end after the deletion,
                    using a keyboard, speech, or similar method, the inputType
                    MUST be <b>
                        deleteContentForward</b>
                    </li>

                    <li>If the user intends to undo the last editing action
                    using a keyboard, IME, speech, or similar method, the
                    inputType MUST be <b>
                        undo</b>
                    </li>

                    <li>If the user intends to redo the last editing action
                    using a keyboard, IME, speech, or similar method, the
                    inputType MUST be <b>
                        redo</b>
                    </li>

                    <li>If the user intends to cut using a keyboard, context
                    menu, speech, or similar method, the inputType MUST be <b>
                        cut</b>
                    </li>

                    <li>If the user intends to paste using a keyboard, context
                    menu, speech, or similar method, the inputType MUST be <b>
                        paste</b>
                    </li>

                    <li>If the user intends to initiate bold text using a
                    keyboard, context menu, speech, or similar method, the
                    inputType MUST be <b>
                        bold</b>
                    </li>

                    <li>If the user intends to initiate italic text using a
                    keyboard, context menu, speech, or similar method, the
                    inputType MUST be <b>
                        italic</b>
                    </li>

                    <li>If the user intends to initiate underline text using a
                    keyboard, context menu, speech, or similar method, the
                    inputType MUST be <b>
                        underline</b>
                    </li>

                    <li>If the user intends to initiate stricken through text
                    using a keyboard, context menu, speech, or similar method,
                    the inputType MUST be <b>
                        strikeThrough</b>
                    </li>

                    <li>If the user intends to initiate superscript through text
                    using a keyboard, context menu, speech, or similar method,
                    the inputType MUST be <b>
                        superscript</b>
                    </li>

                    <li>If the user intends to initiate subscript through text
                    using a keyboard, context menu, speech, or similar method,
                    the inputType MUST be <b>
                        subscript</b>
                    </li>

                    <li>If the user intends to justify center the current
                    selection using a keyboard, context menu, speech, or
                    similar method, the inputType MUST be <b>
                        justifyCenter</b>
                    </li>

                    <li>If the user intends to justify right the current
                    selection using a keyboard, context menu, speech, or
                    similar method, the inputType MUST be <b>
                        justifyRight</b>
                    </li>

                    <li>If the user intends to justify left the current
                    selection using a keyboard, context menu, speech, or
                    similar method, the inputType MUST be <b>
                        justifyLeft</b>
                    </li>

                    <li>If the user intends to indent the current
                    selection using a keyboard, context menu, speech, or
                    similar method, the inputType MUST be <b>
                        indent</b>
                    </li>

                    <li>If the user intends to outdent the current
                    selection using a keyboard, context menu, speech, or
                    similar method, the inputType MUST be <b>
                        outdent</b>
                    </li>

                    <li>If the user intends to remove all formatting from the
                    current selection using a keyboard, context menu, speech,
                    or similar method, the inputType MUST be <b>
                        removeFormat</b>
                    </li>

                    <li>If the user intends to drag the current selection using
                        keyboard, context menu, speech, or similar method, the
                        inputType MUST be <b>drag</b>
                    </li>

                    <li>If the user intends to drop a dragged object into the
                    current selection using a keyboard, context menu, speech,
                    or similar method, the inputType MUST be <b>drop</b>
                    </li>

                </ol>

                <p><dfn><code>data</code></dfn> holds information plaintext data that is to
                be added to the document.
                </p>

                <ol>
                    <li>If the inputType is insertText, the value of data is to be
                    the plain text string to be inserted.</li>
                    <li>Else, the value of data is to be NULL.</li>
                </ol>

                <p><dfn data-dfn-for=InputEvent>dataTransfer</dfn> holds information about richtext and
                plaintext data that is to be taken from or added to the document
                in a <a>DataTransfer</a> object if there is relevant data.
                </p>

                <ol>
                    <li>If the inputType is cut, paste, drag, drop,
                    or insertNonText, the dataTransfer attribute is a
                    prepopulated <a>DataTransfer</a> object so that:
                        <ol>
                            <li><code>dataTransfer.getData('text/html')</code> returns a HTML representation
                            of the content that is to be cut, copied, pasted, dragged, dropped or added.
                            <li><code>dataTransfer.getData('text/plain')</code> returns a plain text
                            representation of the content that is to be cut, copied, pasted, dragged,
                            dropped or added.</li>
                        </ol>
                    </li>
                    <li>Else, the dataTransfer attribute is NULL.</li>
                </ol>

                <p>The following table provides a summary of when the <a>data</a>
                and <a>dataTransfer</a> attributes are defined or not defined based
                on the inputType.</p>


                <table class="parameters">
                    <thead>
                        <tr><th>inputType</th><th>data</th><th>dataTransfer</th></tr>
                    </thead>
                    <tbody>
                        <tr><td><code>insertText</code></td><td>Yes</td><td>No</td></tr>
                        <tr><td><code>cut</code></td><td>No</td><td>Yes</td></tr>
                        <tr><td><code>paste</code></td><td>No</td><td>Yes</td></tr>
                        <tr><td><code>drag</code></td><td>No</td><td>Yes</td></tr>
                        <tr><td><code>drop</code></td><td>No</td><td>Yes</td></tr>
                        <tr><td><code>insertNonText</code></td><td>No</td><td>Yes</td></tr>
                        <tr><td>All Remaining</td><td>No</td><td>No</td></tr>
                    </tbody>
                </table>

            </section><!-- interface-InputEvent-Attributes -->
            <section id="interface-InputEvent-Methods" dfn-for="InputEvent">
                <h5>Methods</h5>

                <p><dfn>getTargetRanges</dfn> return an Array of
                <dfn lt="StaticRange">StaticRanges</dfn> [[!STATIC-RANGE]]
                affected by this event.</p>

            </section><!-- interface-InputEvent-Methods -->



        </section><!-- interface-InputEvent -->

        <section id="event-definitions">
            <h4>Event definitions</h4>


        <div class="event-definition">
            <dl>
                <dt id="event-type-beforeinput"><dfn><a class="eventtype" href=
                "#event-type-beforeinput"><code>beforeinput</code></a></dfn></dt>

                <dd>
                    <table border="0" cellpadding="2" cellspacing="0" summary=
                    "This table contains information about the semantics of the given event type">
                    <tr>
                            <th>Type</th>

                            <td><strong><code>beforeinput</code></strong></td>
                        </tr>

                        <tr>
                            <th>Interface</th>

                            <td>
                                <a href=
                                "#interface-InputEvent"><code>InputEvent</code></a>
                            </td>
                        </tr>

                        <tr>
                            <th>Sync / Async</th>

                            <td>Sync</td>
                        </tr>

                        <tr>
                            <th>Bubbles</th>

                            <td>Yes</td>
                        </tr>

                        <tr>
                            <th>Trusted Targets</th>

                            <td>Any <code>Element</code> with
                            <code>contenteditable</code> attribute
                            enabled.</td>
                        </tr>

                        <tr>
                            <th>Cancelable</th>

                            <td>Varies: False for inputTypes insertText and deleteComposedCharacter during IME composition. True otherwise</td>
                        </tr>

                        <tr>
                            <th>Default action</th>

                            <td>Varies: 'Update the DOM' for contentEditable=typing editing hosts for inputTypes insertText and deleteComposedCharacter. 'Update the DOM element' for contentEditable=true editing hosts for all inputTypes. None otherwise.</td>
                        </tr>

                        <tr>
                            <th>Context<br>
                            (trusted events)</th>

                            <td>
                                <ul>
                                    <li>
                                        <a href=
                                        "#widl-Event-target"><code class=
                                        "attribute-name">Event.target</code></a>:
                                        <a class="def" href=
                                        "#glossary-event-target">event
                                        target</a> that is about to be updated
                                    </li>

                                    <li>
                                        <a href=
                                        "#widl-UIEvent-view"><code class=
                                        "attribute-name">UIEvent.view</code></a>:
                                        <a class="def" href=
                                        "#glossary-window"><code>Window</code></a>
                                    </li>

                                    <li>
                                        <a href=
                                        "#widl-UIEvent-detail"><code class=
                                        "attribute-name">UIEvent.detail</code></a>:
                                        <code>0</code>
                                    </li>

                                    <li>
                                        <a href=
                                        "#widl-InputEvent-data"><code class=
                                        "attribute-name">InputEvent.data</code></a>:
                                        the string containing the data that
                                        will be added to the element, which MAY
                                        be the <a class="def" href=
                                        "#glossary-empty-string">empty
                                        string</a> if the content has been
                                        deleted, or NULL if it doesn't apply.
                                    </li>

                                    <li>
                                        <a href=
                                        "#widl-InputEvent-isComposing"><code class="attribute-name">
                                        InputEvent.isComposing</code></a>:
                                        <code>true</code> if this event is
                                        dispatched during a <a href=
                                        "#keys-dead">dead key</a> sequence or
                                        while an <a href="#glossary-ime">input
                                        method editor</a> is active (such that
                                        <a href=
                                        "#events-compositionevents">composition
                                        events</a> are being dispatched);
                                        <code>false</code> otherwise.
                                    </li>
                                    <li>
                                        <a href=
                                        "#widl-InputEvent-cancelable"><code class="attribute-name">
                                        InputEvent.cancelable</code></a>:
                                        <code>true</code> if this event can be canceled.
                                        <code>false</code> otherwise.
                                        <p class="note">All beforeinput events MUST be cancelable, unless they take place during IME composition.</p>
                                    </li>
                                </ul>
                            </td>
                        </tr>
                    </table>

                    <p>A <a class="def" href="#glossary-user-agent">user
                    agent</a> MUST dispatch this event when the user has
                    attempted to input in a contenteditable element. It does
                    not necessarily mean the user agent will then update the
                    DOM.</p>

                    <p>A <a class="def" href="#glossary-user-agent">user
                    agent</a> MUST NOT dispatch this event due to events that
                    are not caused by attempted user input, such as system
                    events.</p>
                </dd>
            </dl>
        </div><!-- beforeinput -->
        <!-- input -->

        <div class="event-definition">
            <dl>
                <dt id="event-type-input"><dfn><a class="eventtype" href=
                "#event-type-input"><code>input</code></a></dfn></dt>

                <dd>
                    <table border="0" cellpadding="2" cellspacing="0" summary=
                    "This table contains information about the semantics of the given event type">
                    <tr>
                            <th>Type</th>

                            <td><strong><code>input</code></strong></td>
                        </tr>

                        <tr>
                            <th>Interface</th>

                            <td>
                                <a href=
                                "#interface-InputEvent"><code>InputEvent</code></a>
                            </td>
                        </tr>

                        <tr>
                            <th>Sync / Async</th>

                            <td>Sync</td>
                        </tr>

                        <tr>
                            <th>Bubbles</th>

                            <td>Yes</td>
                        </tr>

                        <tr>
                            <th>Trusted Targets</th>

                            <td>Any <code>Element</code> with
                            <code>contenteditable</code> attribute
                            enabled.</td>
                        </tr>

                        <tr>
                            <th>Cancelable</th>

                            <td>No</td>
                        </tr>

                        <tr>
                            <th>Default action</th>

                            <td>None</td>
                        </tr>

                        <tr>
                            <th>Context<br>
                            (trusted events)</th>

                            <td>
                                <ul>
                                    <li>
                                        <a href=
                                        "#widl-Event-target"><code class=
                                        "attribute-name">Event.target</code></a>:
                                        <a class="def" href=
                                        "#glossary-event-target">event
                                        target</a> that was just updated
                                    </li>

                                    <li>
                                        <a href=
                                        "#widl-UIEvent-view"><code class=
                                        "attribute-name">UIEvent.view</code></a>:
                                        <a class="def" href=
                                        "#glossary-window"><code>Window</code></a>
                                    </li>

                                    <li>
                                        <a href=
                                        "#widl-UIEvent-detail"><code class=
                                        "attribute-name">UIEvent.detail</code></a>:
                                        <code>0</code>
                                    </li>

                                    <li>
                                        <a href=
                                        "#widl-InputEvent-data"><code class=
                                        "attribute-name">InputEvent.data</code></a>:
                                        the string containing the data that was
                                        added to the element, which MAY be the
                                        <a class="def" href=
                                        "#glossary-empty-string">empty
                                        string</a> if the content has been
                                        deleted, or NULL if it doesn't apply.
                                    </li>

                                    <li>
                                        <a href=
                                        "#widl-InputEvent-isComposing"><code class="attribute-name">
                                        InputEvent.isComposing</code></a>:
                                        <code>true</code> if this event is
                                        dispatched during a <a href=
                                        "#keys-dead">dead key</a> sequence or
                                        while an <a href="#glossary-ime">input
                                        method editor</a> is active (such that
                                        <a href=
                                        "#events-compositionevents">composition
                                        events</a> are being dispatched);
                                        <code>false</code> otherwise.
                                    </li>
                                    <li>
                                        <a href=
                                        "#widl-InputEvent-cancelable"><code class="attribute-name">
                                        InputEvent.cancelable</code></a>:
                                        <code>false</code>
                                    </li>
                                </ul>
                            </td>
                        </tr>
                    </table>

                    <p>A <a class="def" href="#glossary-user-agent">user
                    agent</a> MUST dispatch this event immediately after the
                    DOM has been updated.</p>
                </dd>
            </dl>
        </div><!-- input -->
    </section><!-- event definitions -->

    <section>
        <h2>Acknowledgements</h2>
        <p>Thanks to:
        Robin Berjon,
        Enrica Casucci,
        Olivier Forget,
        Aryeh Gregor,
        Marijn Haverbeke,
        Yoshifumi Inoue,
        Koji Ishii,
        Gary Kacmarcik,
        Frederico Caldeira Knabben,
        Takayoshi Kochi,
        Piotrek Koszuliński,
        Travis Leithead,
        Grisha Lyukshin,
        Chaals McCathie Nevile,
        Masayuki Nakano,
        Ryosuke Niwa,
        Ben Peters,
        Florian Rivoal,
        Morgan Smith,
        Hallvord R. M. Steen,
        Johan Sörlin,
        Cristian Talau,
        Dave Tapuska,
        Ojan Vafai,
        Léonie Watson,
        Xiaoqian Wu,
        Chong Zhang,
        Joanmarie,
        and everyone in the Editing Taskforce for their input and feedback.
        </p>
    </section>
</body>
</html>
